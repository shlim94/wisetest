var Canvas2Image=function(){var f=!1,n=document.createElement("canvas");if(n.getContext("2d")&&(f=!0),!f)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var h=!!n.getContext("2d").getImageData,e=!!n.toDataURL,c=!!window.btoa,t="image/octet-stream",l=function(n){var t=parseInt(n.width),i=parseInt(n.height);return n.getContext("2d").getImageData(0,0,t,i)},o=function(n){var i="",r,t;if(typeof n=="string")i=n;else for(r=n,t=0;t<r.length;t++)i+=String.fromCharCode(r[t]);return btoa(i)},a=function(n){var i=[],s=n.width,c=n.height,r,t,u,f,e,y,l,h,a,v,w;for(i.push(66),i.push(77),r=s*c*3+54,i.push(r%256),r=Math.floor(r/256),i.push(r%256),r=Math.floor(r/256),i.push(r%256),r=Math.floor(r/256),i.push(r%256),i.push(0),i.push(0),i.push(0),i.push(0),i.push(54),i.push(0),i.push(0),i.push(0),t=[],t.push(40),t.push(0),t.push(0),t.push(0),u=s,t.push(u%256),u=Math.floor(u/256),t.push(u%256),u=Math.floor(u/256),t.push(u%256),u=Math.floor(u/256),t.push(u%256),f=c,t.push(f%256),f=Math.floor(f/256),t.push(f%256),f=Math.floor(f/256),t.push(f%256),f=Math.floor(f/256),t.push(f%256),t.push(1),t.push(0),t.push(24),t.push(0),t.push(0),t.push(0),t.push(0),t.push(0),e=s*c*3,t.push(e%256),e=Math.floor(e/256),t.push(e%256),e=Math.floor(e/256),t.push(e%256),e=Math.floor(e/256),t.push(e%256),y=0;y<16;y++)t.push(0);var d=(4-s*3%4)%4,p=n.data,b="",k=c;do{for(l=s*(k-1)*4,h="",a=0;a<s;a++)v=4*a,h+=String.fromCharCode(p[l+v+2]),h+=String.fromCharCode(p[l+v+1]),h+=String.fromCharCode(p[l+v]);for(w=0;w<d;w++)h+=String.fromCharCode(0);b+=h}while(--k);return o(i.concat(t))+o(b)},i=function(n){document.location.href=n},s=function(n,t){return"data:"+t+";base64,"+n},r=function(n){var t=document.createElement("img");return t.src=n,t},u=function(n,t,i){var r,u;return t&&i?(r=document.createElement("canvas"),r.width=t,r.height=i,r.style.width=t+"px",r.style.height=i+"px",u=r.getContext("2d"),u.drawImage(n,0,0,n.width,n.height,0,0,t,i),r):n};return{saveAsPNG:function(n,f,o,s){if(!e)return!1;var c=u(n,o,s),h=c.toDataURL("image/png");return f?r(h):(i(h.replace("image/png",t)),!0)},saveAsJPEG:function(n,f,o,s){if(!e)return!1;var l=u(n,o,s),h="image/jpeg",c=l.toDataURL(h);return c.indexOf(h)!=5?!1:f?r(c):(i(c.replace(h,t)),!0)},saveAsBMP:function(n,f,e,o){if(!(h&&c))return!1;var y=u(n,e,o),p=l(y),v=a(p);return f?r(s(v,"image/bmp")):(i(s(v,t)),!0)}}}()